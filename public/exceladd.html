<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>動的テキストボックスとデータベース名の入力</title>
    <style>
        .textbox-container {
            margin-bottom: 10px;
        }
        .back-button-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
        }
    </style>
</head>
<body>
    <h1>SQLiteファイル名とテキストボックスの動的追加</h1>

    <!-- SQLiteファイル名入力用テキストボックス -->
    <label for="filename-input">SQLiteファイル名を入力 (拡張子不要):</label>
    <input type="text" id="filename-input" placeholder="ファイル名を入力" required><br><br>

    <!-- テキストボックスの数を入力 -->
    <label for="number-input">テキストボックスの数を入力:</label>
    <input type="number" id="number-input" placeholder="整数を入力" min="1" oninput="createTextboxes()"><br><br>

    <!-- 動的にテキストボックスが追加されるコンテナ -->
    <div id="textbox-container"></div>
    
    <!-- データを送信するボタン -->
    <button onclick="saveInspectionData()">指定されたファイルにデータを保存</button>

    <!-- 戻るボタンをページ最下部に配置 -->
    <div class="back-button-container">
        <button onclick="window.location.href = 'index.html';">戻る</button>
    </div>

    <script>
        // テキストボックスを動的に作成する関数
        function createTextboxes() {
            const container = document.getElementById('textbox-container');
            const numberInput = document.getElementById('number-input').value;

            // 現在のテキストボックスをすべてクリア
            container.innerHTML = '';

            // 入力された整数値に応じてテキストボックスを生成
            const numberOfTextboxes = parseInt(numberInput);

            if (!isNaN(numberOfTextboxes) && numberOfTextboxes > 0) {
                for (let i = 0; i < numberOfTextboxes; i++) {
                    const newTextboxContainer = document.createElement('div');
                    newTextboxContainer.className = 'textbox-container';

                    const newTextbox = document.createElement('input');
                    newTextbox.type = 'text';
                    newTextbox.className = 'textbox';
                    newTextbox.placeholder = `テキストボックス ${i + 1}`;

                    newTextboxContainer.appendChild(newTextbox);
                    container.appendChild(newTextboxContainer);
                }
            }
        }

        // データをサーバーに送信する関数 (tenkenデータベースに保存)
        function saveInspectionData() {
            const textboxes = document.querySelectorAll('.textbox');
            const values = [];
            const filename = document.getElementById('filename-input').value;

            // ファイル名が入力されていない場合はエラーを表示
            if (!filename) {
                alert('ファイル名を入力してください');
                return;
            }

            // 全ての動的に作成されたテキストボックスの値を取得
            textboxes.forEach(textbox => {
                if (textbox.value !== '') {
                    values.push(textbox.value);
                }
            });

            // サーバーにPOSTリクエストを送信
            fetch('/submit-inspection', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ item: values[0], result: values[1], filename: filename }),  // 最初の2つのテキストボックスを使用
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);  // サーバーからのレスポンスをアラートで表示
                // 成功時にexcelladdcomplete.htmlに遷移
                window.location.href = 'excelladdcomplete.html';
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
